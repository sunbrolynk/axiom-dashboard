<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AudiMeta">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icon-192.png">
    <title>Axiom Geo Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>

<div id="map"></div>

<div class="glass map-loading" id="loading">
    <div class="pulse-ring"></div>
    <span>Querying Axiom...</span>
</div>

<!-- Top Bar -->
<div class="glass top-bar">
    <div class="brand">
        <div class="brand-icon">AM</div>
        <div class="brand-text">
            <h1>Axiom Geo</h1>
            <div class="subtitle">Request Analytics</div>
        </div>
    </div>
    <div class="top-right">
        <div class="pill-select" id="time-pills">
            <button class="pill-option" data-hours="6">6h</button>
            <button class="pill-option" data-hours="24">24h</button>
            <button class="pill-option active" data-hours="168">7d</button>
            <button class="pill-option" data-hours="720">30d</button>
        </div>
        <button class="refresh-btn" id="refresh-btn" onclick="loadData()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            <span class="refresh-label">Refresh</span>
        </button>
        <span class="updated-text" id="last-updated"></span>
    </div>
</div>

<!-- Stats -->
<div class="stats-row">
    <div class="glass stat-card"><div class="label">Requests</div><div class="value accent" id="total-requests">—</div></div>
    <div class="glass stat-card"><div class="label">Unique IPs</div><div class="value" id="unique-ips">—</div></div>
    <div class="glass stat-card"><div class="label">Locations</div><div class="value" id="total-locations">—</div></div>
    <div class="glass stat-card"><div class="label">Error Rate</div><div class="value" id="error-rate">—</div></div>
</div>

<!-- Side Panel (desktop) -->
<div class="side-panel">
    <div class="glass panel-section grow">
        <div class="panel-title">Top Sources <span class="count" id="ip-count"></span></div>
        <div class="ip-list" id="ip-list"></div>
    </div>
    <div class="glass panel-section">
        <div class="panel-title">Status Codes</div>
        <div class="status-row" id="status-list"></div>
    </div>
    <div class="glass panel-section grow">
        <div class="panel-title">Top Endpoints <span class="count" id="ep-count"></span></div>
        <div class="ep-list" id="ep-list"></div>
    </div>
</div>

<!-- Bottom Sheet (mobile) -->
<div class="sheet-backdrop" id="sheet-backdrop" onclick="toggleSheet()"></div>
<button class="bottom-sheet-toggle glass" id="sheet-toggle" onclick="toggleSheet()">☰</button>
<div class="glass bottom-sheet" id="bottom-sheet">
    <div class="sheet-handle-bar" onclick="toggleSheet()"><div class="sheet-handle"></div></div>
    <div class="sheet-content">
        <div class="sheet-section">
            <div class="panel-title">Top Sources <span class="count" id="m-ip-count"></span></div>
            <div class="ip-list" id="m-ip-list"></div>
        </div>
        <div class="sheet-section">
            <div class="panel-title">Status Codes</div>
            <div class="status-row" id="m-status-list"></div>
        </div>
        <div class="sheet-section">
            <div class="panel-title">Top Endpoints <span class="count" id="m-ep-count"></span></div>
            <div class="ep-list" id="m-ep-list"></div>
        </div>
    </div>
</div>

<!-- Scripts: order matters — map.js and ui.js define functions, app.js uses them -->
<script src="/static/js/map.js"></script>
<script src="/static/js/ui.js"></script>
<script src="/static/js/app.js"></script>
<script async src="https://maps.googleapis.com/maps/api/js?key=__GOOGLE_MAPS_API_KEY__&libraries=visualization&callback=initMap"></script>

</body>
</html>
